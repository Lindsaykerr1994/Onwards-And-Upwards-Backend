{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/tables.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal.css' %}">
{% endblock %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col">

            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
<div class="body-container container-fluid">
    <div class="welcome-container row my-3">
        <div class="col">
            <h1>Welcome Back, Tony</h1>
            <h3>Today is <span id="show-date"></span></h3>
        </div>
    </div>
    <div class="appointment-container row my-3">
        <div class="col-12 mx-auto">
            <h4 class="d-inline-block">Upcoming Appointments</h4>
            <a href="{% url 'add_client' %}" class="d-inline-block float-right icon-btn">
                <i class="fas fa-user-plus"></i>
            </a>
            <a href="{% url 'add_app' %}" class="d-inline-block float-right icon-btn">
                <i class="fas fa-calendar-plus"></i>
            </a>
            <table class="table table-hover">
                <thead>
                    <th></th>
                    <th>Ref. No.</th>
                    <th>Date</th>
                    <th>Client</th>
                    <th>Activity</th>
                </thead>
                <tbody>
                    <!-- Limit To Next 5 or 10 Appointments -->
                    {% for appointment in appointments %}
                    <tr>
                        <td><a href="{% url 'view_app' appointment.appointment_number %}"><i class="fas fa-search"></i></a></td>
                        <td>{{ appointment.appointment_number }}</td>
                        <td>{{ appointment.appointment_date }}</td>
                        <td>{{ appointment.client }}</td>
                        <td>{{ appointment.activity }}</td>
                        <td class="delete-btn" data-appid="{{ appointment.appointment_number }}">
                            <i class="fas fa-trash text-danger"></i>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{% url 'all_appointments' %}" class="float-right link-specs">View All</a>
        </div>
    </div>
</div>
<div class="modal" id="delete-modal">
    <p>Are you sure you wish to delete this client?</p>
    <p>Last Name, First Name</p>
    <button>Cancel</button>
    <button class="confirm-delete-btn">Confirm</button>
</div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    <script>
        function updateTime() {
            var date = new Date;
            var now = moment().format("dddd, MMM Do, YYYY, h:mm A");
            $("#show-date").text(now);
        }
        updateTime();
        setInterval(updateTime, 60000);
    </script>
    <script>
        $(".delete-btn").click(function(){
            var appId = $(this).attr("data-appid");
            currentURL = window.location.href;
            newUrl = `${currentURL}/appointments/delete_appointment/${appId}`;
            var modal = document.getElementById("delete-modal");
            console.log(modal);
            modal.style.display = "block";
            $(".confirm-delete-btn").click(function(){
                window.location = newUrl;
            });
            /* When the user clicks on <span> (x), close the modal
            span.onclick = function() {
            modal.style.display = "none";
            } */
        })
    </script>
{% endblock%}