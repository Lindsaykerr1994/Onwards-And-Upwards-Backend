{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/forms.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal.css' %}">
{% endblock %}

{% block extra_title %}- Risk Acknowledgment Form{% endblock %}

{% block content %}
    <div class="body-container container-fluid">
        <div class="row">
            <div class="col mx-auto">
                <h3>Add Participant Form</h3>
                <h4>Appointment: {{ appointment.appointment_number }}</h4>
            </div>
        </div>
        <div class="row">
            <div class="col-11 mx-auto">
                <form method="POST" class="onwards-form" id="ra-form" action="{% url 'add_part_form' appointment.appointment_number %}">
                    {% csrf_token %}
                    <fieldset>
                        <legend>Participant Details</legend>
                        <input type="text" name="first_name"
                        placeholder="First Name *" required>
                        <input type="text" name="last_name"
                        placeholder="Last Name *" required>
                        <input type="text" name="date_of_birth"
                        placeholder="Date Of Birth *" required>
                        <input type="email" name="email_address"
                        placeholder="Email Address">
                        <input type="text" name="phone_number"
                        placeholder="Phone Number">
                        <input type="text" name="address1"
                        placeholder="Address *" required>
                        <input type="text" name="address2"
                        placeholder="Street Address 2" required>
                        <input type="text" name="address3"
                        placeholder="Street Address 3" required>
                        <input type="text" name="town_or_city"
                        placeholder="Town Or City" required>
                        <input type="text" name="postcode" placeholder="Postcode *" required>
                    </fieldset>
                    <fieldset>
                        <legend>Emergency Contact</legend>
                        <input type="text" name="emergency_name" placeholder="Name">
                        <input type="text" name="emergency_number" placeholder="Number">
                    </fieldset>
                    <fieldset>
                        <legend>Declaration Of Fitness</legend>
                        <label for="dec_illness">
                            Please declare any recent or ongoing injury/condition/illness:
                        </label>
                        <input type="text" name="dec_illness">
                        <label for="dec_medication">
                            Please declare any medication recently or currently taken:
                        </label>
                        <input type="text" name="dec_med">
                        <label for="dec_abs_cond">
                            I certify that to the best of my knowledge I do not suffer from a medical condition which might have the effect of making it more likely that I could be involved in an accident resulting in injury to myself or others.
                        </label>
                        <input type="checkbox" name="dec_abs_cond">
                    </fieldset>
                    <fieldset>
                        <input type="hidden" name="ack_of_risk" id="ack_of_risk">
                        <input type="hidden" name="signed_by" id="signed_by">
                        <input type="hidden" name="date_signed" id="date_signed">
                    </fieldset>
                </form>
                    <button id="submit-btn">Cha cha</button>
            </div>
        </div>
    </div>
    <div class="modal" id="signature-modal">
        <p class="small">I hereby acknowledge and agree that the activities supervised by Onwards And Upwards and its associates have inherent risks. I have full knowledge of the nature and extent of all risks associated with these activities. I understand that failure to exercise due care and to follow guidance and instructions whilst on session may result in my injury or death.</p>
        <input type="checkbox" name="ack_checkbox">
        <label for="signing_input">
            PARTICIPANTâ€™S SIGNATURE:
            <span class="small">(or legal guardian if under 18)</span>
        </label>
        <input type="text" name="signing_input">
        <label for="date_input">
            DATE:
        </label>
        <input type="text" name="date_input">
        <p id="error-message"> </p>
        <button id="cancel-btn">Cancel <i class="far fa-window-close"></i></button>
        <button id="confirm-btn">Confirm <i class="far fa-check-square"></i></button>

    </div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    <script type="text/javascript">
        $("#submit-btn").click(function(event){
            var modal = document.getElementById("signature-modal");
            modal.style.display = "block";
            $("#confirm-btn").click(function(){
                var signName = $("input[name='signing_input']").val();
                var signDate = $("input[name='date_input']").val();
                var ackCheck = $("#ack_checkbox").val()
                if(signName.length > 0 && signDate.length > 0){
                    $("#signed_by").val(signName);
                    $("#date_signed").val(signDate);
                    $("#ack_of_risk").val(ackCheck);
                    console.log("all g, submitting")
                    $("#ra-form").submit();
                }
                $("#error-message").text("Please ensure the form is valid");
            })
            $("#cancel-btn").click(function(){
                modal.style.display = "none";
            })
        })
    </script>
{% endblock %}